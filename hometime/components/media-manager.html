<link rel="import" href="../bower_components/polymer/polymer.html">
<!-- <link rel="import" href="../bower_components/font-roboto/roboto.html"> -->
<!-- import components -->
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-selector/core-selector.html">
<link rel="import" href="../bower_components/core-item/core-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-icons/av-icons.html">
<link rel="import" href="../bower_components/core-icons/hardware-icons.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="../bower_components/core-animated-pages/transitions/list-cascade.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">


<!-- my components -->
<link rel="import" href="../components/video-item.html">


<polymer-element name="media-manager">

    <template id="mainScreen">

        <link rel="stylesheet" href="../assets/css/media-manager.css">

        <core-ajax id="data_hometime" auto url="/app" response="{{data}}" handleAs="json"></core-ajax>

        <core-scaffold responsiveWidth="600px">

            <!-- leftbar -->
            <core-header-panel navigation flex>
                <core-toolbar>
                    <span flex class="menu-title">Select a library</span>
                </core-toolbar>
                <core-selector id="menu" class="menu" selected="{{currentList}}" on-core-select="{{}}">
                    <template repeat="{{l, index in data.library}}">
                        <paper-item label="{{l.label}}" icon="{{l.icon}}">
                            <core-ajax url="{{l.dataUrl}}" auto handleAs="json" response="{{allVideos[index]}}" on-core-response="{{parse}}"></core-ajax>
                        </paper-item>
                    </template>
                </core-selector>
            </core-header-panel>


            <!-- toolbar -->

            <div flex tool class="font-800">Manager</div>


            <!-- content -->
            <div fit class="content">
                <core-animated-pages selected="{{currentList}}" transitions="slide-from-right" style="min-height: 100%;">
                    <template id="lister" is="auto-binding" bind="{{videoLibrary}}" repeat="{{videos, index in videoLibrary}}">
                        <!-- Mode: listing videos -->
                        <section layout vertical style="background-color: #eee;">
                            <div flex>
                                <template repeat="{{ v in videos }}">
                                    <video-item video="{{v}}" queues="{{queues}}" mode="{{currentMode}}"></video-item>
                                </template>
                            </div>
                        </section>
                    </template>
                </core-animated-pages>
                <!-- end video listing -->
            </div>
        </core-scaffold>
    </template>

    <script>
    Polymer("media-manager", {

        allVideos: [],

        currentList: 0,

        totalResponse: 0,

        ready: function() {

            var self = this;

            window.self = self;

            this.lister = this.$.lister;

            this.parse = function(e) {

                self.totalResponse += 1;

                if (self.totalResponse == self.data.library.length) {

                    self.bindVideos();

                };

            };

            this.bindVideos = function() {

                self.lister.model = {

                    videoLibrary: self.allVideos

                }

            };
        }
    });
    </script>

</polymer-element>